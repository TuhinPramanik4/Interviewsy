{"version":3,"file":"CivicAuthLogoutIframeContainer.js","sourceRoot":"","sources":["../../../src/shared/components/CivicAuthLogoutIframeContainer.tsx"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AAEb,OAAO,EAAE,eAAe,EAAE,MAAM,wCAAwC,CAAC;AACzE,OAAO,EAAE,SAAS,EAAE,MAAM,yBAAyB,CAAC;AACpD,OAAO,EAAE,WAAW,EAAE,MAAM,kBAAkB,CAAC;AAC/C,OAAO,EAAE,YAAY,EAAE,MAAM,+BAA+B,CAAC;AAC7D,OAAO,EAAE,WAAW,EAAE,MAAM,aAAa,CAAC;AAC1C,OAAO,EAAE,WAAW,EAAE,MAAM,OAAO,CAAC;AACpC,OAAO,EAAE,YAAY,EAAE,MAAM,uBAAuB,CAAC;AACrD,OAAO,EAAE,mBAAmB,EAAE,MAAM,gBAAgB,CAAC;AAMrD,MAAM,8BAA8B,GAAG,CAAC,EACtC,SAAS,GAAG,KAAK,GACmB,EAAE,EAAE;IACxC,MAAM,EAAE,eAAe,EAAE,GAAG,SAAS,EAAE,CAAC;IACxC,MAAM,QAAQ,GAAG,WAAW,EAAE,CAAC;IAE/B,MAAM,sBAAsB,GAAG,WAAW,CAAC,GAAG,EAAE;QAC9C,IAAI,eAAe,IAAI,eAAe,CAAC,OAAO,EAAE,CAAC;YAC/C,MAAM,GAAG,GAAG,YAAY,CAAC,eAAe,CAAC,OAAO,CAAE,CAAC;YAEnD,IAAI,CAAC,GAAG,EAAE,aAAa,EAAE,CAAC;gBACxB,OAAO;YACT,CAAC;YAED,IAAI,CAAC;gBACH,MAAM,UAAU,GAAG,GAAG,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC;gBAE7D,0FAA0F;gBAC1F,uGAAuG;gBACvG,IAAI,UAAU,CAAC,QAAQ,CAAC,mBAAmB,CAAC,EAAE,CAAC;oBAC7C,MAAM,IAAI,GAAG,GAAG,CAAC,aAAa,CAAC,QAAQ,CAAC,aAAa,CACnD,8CAA8C,CAC/C,CAAC;oBACF,IAAI,IAAI,EAAE,CAAC;wBACT,MAAM,WAAW,GAAG,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,CAAC;wBAC9C,IAAI,WAAW,IAAI,WAAW,KAAK,GAAG,EAAE,CAAC;4BACvC,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,WAAW,CAAC;4BACnC,OAAO,IAAI,CAAC;wBACd,CAAC;oBACH,CAAC;gBACH,CAAC;YACH,CAAC;YAAC,MAAM,CAAC;gBACP,2CAA2C;YAC7C,CAAC;QACH,CAAC;QACD,OAAO,KAAK,CAAC,CAAC,gCAAgC;IAChD,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,CAAC;IAEtB,uEAAuE;IACvE,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CACxB,MAAC,YAAY,IAAC,aAAa,EAAE,IAAI,aAC9B,SAAS,CAAC,CAAC,CAAC,CACX,cACE,EAAE,EAAC,iCAAiC,EACpC,KAAK,EAAE;oBACL,QAAQ,EAAE,UAAU;oBACpB,KAAK,EAAE,CAAC;oBACR,OAAO,EAAE,MAAM;oBACf,UAAU,EAAE,QAAQ;oBACpB,cAAc,EAAE,QAAQ;iBACzB,YAED,KAAC,WAAW,KAAG,GACX,CACP,CAAC,CAAC,CAAC,IAAI,EACR,KAAC,eAAe,IACd,GAAG,EAAE,eAAe,EACpB,EAAE,EAAE,0BAA0B,EAC9B,MAAM,EAAE,sBAAsB,GAC9B,IACW,CAChB,CAAC;AACJ,CAAC,CAAC;AAEF,OAAO,EAAE,8BAA8B,EAAE,CAAC","sourcesContent":["\"use client\";\n\nimport { CivicAuthIframe } from \"@/shared/components/CivicAuthIframe.js\";\nimport { useIframe } from \"@/shared/hooks/index.js\";\nimport { LoadingIcon } from \"./LoadingIcon.js\";\nimport { IframeChrome } from \"./CivicAuthIframeContainer.js\";\nimport { useIsClient } from \"usehooks-ts\";\nimport { useCallback } from \"react\";\nimport { getIframeRef } from \"../lib/iframeUtils.js\";\nimport { LOGOUT_SUCCESS_TEXT } from \"@/constants.js\";\n\ntype CivicAuthLogoutIframeContainerProps = {\n  isLoading?: boolean;\n};\n\nconst CivicAuthLogoutIframeContainer = ({\n  isLoading = false,\n}: CivicAuthLogoutIframeContainerProps) => {\n  const { logoutIframeRef } = useIframe();\n  const isClient = useIsClient();\n\n  const processLogoutIframeUrl = useCallback(() => {\n    if (logoutIframeRef && logoutIframeRef.current) {\n      const ref = getIframeRef(logoutIframeRef.current)!;\n\n      if (!ref?.contentWindow) {\n        return;\n      }\n\n      try {\n        const iframeBody = ref.contentWindow.document.body.innerHTML;\n\n        // If we have LOGOUT_SUCCESS_TEXT in the body, we know the logout succeeded on the server,\n        // and we should redirect the parent to the post logout success URL indicated in the included link tag.\n        if (iframeBody.includes(LOGOUT_SUCCESS_TEXT)) {\n          const link = ref.contentWindow.document.querySelector(\n            \"a[rel='civic-auth-post-logout-redirect-url']\",\n          );\n          if (link) {\n            const redirectUrl = link.getAttribute(\"href\");\n            if (redirectUrl && redirectUrl !== \"#\") {\n              window.location.href = redirectUrl;\n              return true;\n            }\n          }\n        }\n      } catch {\n        // ignore errors while waiting for redirect\n      }\n    }\n    return false; // Haven't processed the URL yet\n  }, [logoutIframeRef]);\n\n  // don't render the in server-mode as the appearance changes after load\n  return !isClient ? null : (\n    <IframeChrome isFrameLoaded={true}>\n      {isLoading ? (\n        <div\n          id=\"civic-auth-loading-icon-wrapper\"\n          style={{\n            position: \"absolute\",\n            inset: 0,\n            display: \"flex\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n          }}\n        >\n          <LoadingIcon />\n        </div>\n      ) : null}\n      <CivicAuthIframe\n        ref={logoutIframeRef}\n        id={\"civic-auth-logout-iframe\"}\n        onLoad={processLogoutIframeUrl}\n      />\n    </IframeChrome>\n  );\n};\n\nexport { CivicAuthLogoutIframeContainer };\n"]}